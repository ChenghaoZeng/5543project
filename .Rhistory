y = "Percent of households (weighted, 95% CI)"
) +
theme_minimal(base_size = 12)
# Save plot
ggsave("plot_housing_stress_by_lifecycle.png", p1, width = 10, height = 6, dpi = 300)
plot2_df <- mean_cost_by_life %>%
collect() %>%
mutate(
mean_pct = mean_hc_pct * 1,
low = mean_hc_pct_low * 1,
up = mean_hc_pct_upp * 1
) %>%
arrange(mean_pct) %>%
mutate(life_cycle_group = factor(life_cycle_group, levels = unique(life_cycle_group)))
p2 <- ggplot(plot2_df, aes(x = life_cycle_group, y = mean_pct)) +
geom_col() +
geom_errorbar(aes(ymin = low, ymax = up), width = 0.2) +
coord_flip() +
labs(
title = "Mean Weekly Housing Cost (% of gross household income) by Life-cycle group",
x = "Life-cycle group",
y = "Mean weekly housing cost (%) (weighted, 95% CI)"
) +
theme_minimal(base_size = 12)
# Save plot
ggsave("plot_mean_housing_cost_by_lifecycle.png", p2, width = 10, height = 6, dpi = 300)
# Print to the HTML output
p1
p2
#Recode life-cycle group to readable labels & compute derived vars
hh_merged <- hh_merged %>%
mutate(
life_cycle_group = case_when(
life_cycle_group_code == 0  ~ "Not applicable",
life_cycle_group_code == 1  ~ "Lone person <35",
life_cycle_group_code == 2  ~ "Couple (ref <35)",
life_cycle_group_code == 3  ~ "Couple w dependents, eldest <5",
life_cycle_group_code == 4  ~ "Couple w dependents, eldest 5-14",
life_cycle_group_code == 5  ~ "Couple w dependents, eldest 15-24",
life_cycle_group_code == 6  ~ "One parent w dependents",
life_cycle_group_code == 7  ~ "Couple w dep & non-dep",
life_cycle_group_code == 8  ~ "Couple w non-dep only",
life_cycle_group_code == 9  ~ "Couple (ref 55-64)",
life_cycle_group_code == 10 ~ "Couple (ref 65+)",
life_cycle_group_code == 11 ~ "Lone person 65+",
TRUE ~ paste0("Other (", life_cycle_group_code, ")")
),
housing_stress_flag = case_when(
!is.na(weekly_housing_cost_pct) & weekly_housing_cost_pct > 50 ~ 1L,
!is.na(weekly_housing_cost_pct) & weekly_housing_cost_pct <= 50 ~ 0L,
TRUE ~ NA_integer_
),
ability_raise_2000 = case_when(
ability_raise_2000_flag == 1 ~ "Can raise $2000",
ability_raise_2000_flag == 5 ~ "Cannot raise $2000",
TRUE ~ NA_character_
)
)
#Set up survey replicate design (household)
rep_cols <- grep("^WHS\\d{2}$", names(hh_merged), value = TRUE)
if(length(rep_cols) < 1) stop("Replicate weight columns WHS01..WHS60 not found. Rename or supply replicate weights.")
# create srvyr survey object using Fay method (rho = 0.5)
hh_svy <- hh_merged %>%
as_survey_rep(weights = hh_weight,
repweights = all_of(rep_cols),
type = "Fay",
rho = 0.5)
# Proportion of households in housing stress (>30%) by life-cycle group
stress_by_life <- hh_svy %>%
group_by(life_cycle_group) %>%
summarize(
pct_stress = survey_mean(housing_stress_flag, vartype = c("ci","se"), na.rm = TRUE)
) %>%
arrange(desc(pct_stress))
stress_by_life %>% collect() %>% print(n = Inf)
#Mean weekly housing cost % by life-cycle group
mean_cost_by_life <- hh_svy %>%
group_by(life_cycle_group) %>%
summarize(
mean_hc_pct = survey_mean(weekly_housing_cost_pct, vartype = c("ci","se"), na.rm = TRUE)
) %>%
arrange(desc(mean_hc_pct))
mean_cost_by_life %>% collect() %>% print(n = Inf)
plot1_df <- stress_by_life %>%
collect() %>%
mutate(
pct = pct_stress * 100,
low = pct_stress_low * 100,
up  = pct_stress_upp * 100
) %>%
arrange(pct) %>%
mutate(life_cycle_group = factor(life_cycle_group, levels = unique(life_cycle_group)))
p1 <- ggplot(plot1_df, aes(x = life_cycle_group, y = pct)) +
geom_col() +
geom_errorbar(aes(ymin = low, ymax = up), width = 0.2) +
coord_flip() +
scale_y_continuous(labels = function(x) paste0(x, "%")) +
labs(
title = "Proportion of Households in Housing Stress (>30% housing costs)",
x = "Life-cycle group",
y = "Percent of households (weighted, 95% CI)"
) +
theme_minimal(base_size = 12)
# Save plot
ggsave("plot_housing_stress_by_lifecycle.png", p1, width = 10, height = 6, dpi = 300)
plot2_df <- mean_cost_by_life %>%
collect() %>%
mutate(
mean_pct = mean_hc_pct * 1,
low = mean_hc_pct_low * 1,
up = mean_hc_pct_upp * 1
) %>%
arrange(mean_pct) %>%
mutate(life_cycle_group = factor(life_cycle_group, levels = unique(life_cycle_group)))
p2 <- ggplot(plot2_df, aes(x = life_cycle_group, y = mean_pct)) +
geom_col() +
geom_errorbar(aes(ymin = low, ymax = up), width = 0.2) +
coord_flip() +
labs(
title = "Mean Weekly Housing Cost (% of gross household income) by Life-cycle group",
x = "Life-cycle group",
y = "Mean weekly housing cost (%) (weighted, 95% CI)"
) +
theme_minimal(base_size = 12)
# Save plot
ggsave("plot_mean_housing_cost_by_lifecycle.png", p2, width = 10, height = 6, dpi = 300)
# Print to the HTML output
p1
p2
#Quick comparison: single-parent households vs others
single_parent_summary <- hh_svy %>%
mutate(is_single_parent = (life_cycle_group == "One parent w dependents")) %>%
group_by(is_single_parent) %>%
summarize(
pct_in_stress = survey_mean(housing_stress_flag, vartype = c("ci","se"), na.rm = TRUE),
mean_hc_pct = survey_mean(weekly_housing_cost_pct, vartype = c("ci","se"), na.rm = TRUE)
)
single_parent_summary %>% collect() %>% print()
#Recode life-cycle group to readable labels & compute derived vars
hh_merged <- hh_merged %>%
mutate(
life_cycle_group = case_when(
life_cycle_group_code == 0  ~ "Not applicable",
life_cycle_group_code == 1  ~ "Lone person <35",
life_cycle_group_code == 2  ~ "Couple (ref <35)",
life_cycle_group_code == 3  ~ "Couple w dependents, eldest <5",
life_cycle_group_code == 4  ~ "Couple w dependents, eldest 5-14",
life_cycle_group_code == 5  ~ "Couple w dependents, eldest 15-24",
life_cycle_group_code == 6  ~ "One parent w dependents",
life_cycle_group_code == 7  ~ "Couple w dep & non-dep",
life_cycle_group_code == 8  ~ "Couple w non-dep only",
life_cycle_group_code == 9  ~ "Couple (ref 55-64)",
life_cycle_group_code == 10 ~ "Couple (ref 65+)",
life_cycle_group_code == 11 ~ "Lone person 65+",
TRUE ~ paste0("Other (", life_cycle_group_code, ")")
),
housing_stress_flag = case_when(
!is.na(weekly_housing_cost_pct) & weekly_housing_cost_pct > 20 ~ 1L,
!is.na(weekly_housing_cost_pct) & weekly_housing_cost_pct <= 20 ~ 0L,
TRUE ~ NA_integer_
),
ability_raise_2000 = case_when(
ability_raise_2000_flag == 1 ~ "Can raise $2000",
ability_raise_2000_flag == 5 ~ "Cannot raise $2000",
TRUE ~ NA_character_
#Recode life-cycle group to readable labels & compute derived vars
hh_merged <- hh_merged %>%
mutate(
life_cycle_group = case_when(
life_cycle_group_code == 0  ~ "Not applicable",
life_cycle_group_code == 1  ~ "Lone person <35",
life_cycle_group_code == 2  ~ "Couple (ref <35)",
life_cycle_group_code == 3  ~ "Couple w dependents, eldest <5",
life_cycle_group_code == 4  ~ "Couple w dependents, eldest 5-14",
life_cycle_group_code == 5  ~ "Couple w dependents, eldest 15-24",
life_cycle_group_code == 6  ~ "One parent w dependents",
life_cycle_group_code == 7  ~ "Couple w dep & non-dep",
life_cycle_group_code == 8  ~ "Couple w non-dep only",
life_cycle_group_code == 9  ~ "Couple (ref 55-64)",
life_cycle_group_code == 10 ~ "Couple (ref 65+)",
life_cycle_group_code == 11 ~ "Lone person 65+",
TRUE ~ paste0("Other (", life_cycle_group_code, ")")
),
housing_stress_flag = case_when(
!is.na(weekly_housing_cost_pct) & weekly_housing_cost_pct > 20 ~ 1L,
!is.na(weekly_housing_cost_pct) & weekly_housing_cost_pct <= 20 ~ 0L,
TRUE ~ NA_integer_
),
ability_raise_2000 = case_when(
ability_raise_2000_flag == 1 ~ "Can raise $2000",
ability_raise_2000_flag == 5 ~ "Cannot raise $2000",
TRUE ~ NA_character_
)
)
#Set up survey replicate design (household)
rep_cols <- grep("^WHS\\d{2}$", names(hh_merged), value = TRUE)
if(length(rep_cols) < 1) stop("Replicate weight columns WHS01..WHS60 not found. Rename or supply replicate weights.")
# create srvyr survey object using Fay method (rho = 0.5)
hh_svy <- hh_merged %>%
as_survey_rep(weights = hh_weight,
repweights = all_of(rep_cols),
type = "Fay",
rho = 0.5)
# Proportion of households in housing stress (>30%) by life-cycle group
stress_by_life <- hh_svy %>%
group_by(life_cycle_group) %>%
summarize(
pct_stress = survey_mean(housing_stress_flag, vartype = c("ci","se"), na.rm = TRUE)
) %>%
arrange(desc(pct_stress))
stress_by_life %>% collect() %>% print(n = Inf)
#Mean weekly housing cost % by life-cycle group
mean_cost_by_life <- hh_svy %>%
group_by(life_cycle_group) %>%
summarize(
mean_hc_pct = survey_mean(weekly_housing_cost_pct, vartype = c("ci","se"), na.rm = TRUE)
) %>%
arrange(desc(mean_hc_pct))
mean_cost_by_life %>% collect() %>% print(n = Inf)
plot1_df <- stress_by_life %>%
collect() %>%
mutate(
pct = pct_stress * 100,
low = pct_stress_low * 100,
up  = pct_stress_upp * 100
) %>%
arrange(pct) %>%
mutate(life_cycle_group = factor(life_cycle_group, levels = unique(life_cycle_group)))
p1 <- ggplot(plot1_df, aes(x = life_cycle_group, y = pct)) +
geom_col() +
geom_errorbar(aes(ymin = low, ymax = up), width = 0.2) +
coord_flip() +
scale_y_continuous(labels = function(x) paste0(x, "%")) +
labs(
title = "Proportion of Households in Housing Stress (>30% housing costs)",
x = "Life-cycle group",
y = "Percent of households (weighted, 95% CI)"
) +
theme_minimal(base_size = 12)
# Save plot
ggsave("plot_housing_stress_by_lifecycle.png", p1, width = 10, height = 6, dpi = 300)
plot2_df <- mean_cost_by_life %>%
collect() %>%
mutate(
mean_pct = mean_hc_pct * 1,
low = mean_hc_pct_low * 1,
up = mean_hc_pct_upp * 1
) %>%
arrange(mean_pct) %>%
mutate(life_cycle_group = factor(life_cycle_group, levels = unique(life_cycle_group)))
p2 <- ggplot(plot2_df, aes(x = life_cycle_group, y = mean_pct)) +
geom_col() +
geom_errorbar(aes(ymin = low, ymax = up), width = 0.2) +
coord_flip() +
labs(
title = "Mean Weekly Housing Cost (% of gross household income) by Life-cycle group",
x = "Life-cycle group",
y = "Mean weekly housing cost (%) (weighted, 95% CI)"
) +
theme_minimal(base_size = 12)
# Save plot
ggsave("plot_mean_housing_cost_by_lifecycle.png", p2, width = 10, height = 6, dpi = 300)
# Print to the HTML output
p1
p2
#Recode life-cycle group to readable labels & compute derived vars
hh_merged <- hh_merged %>%
mutate(
life_cycle_group = case_when(
life_cycle_group_code == 0  ~ "Not applicable",
life_cycle_group_code == 1  ~ "Lone person <35",
life_cycle_group_code == 2  ~ "Couple (ref <35)",
life_cycle_group_code == 3  ~ "Couple w dependents, eldest <5",
life_cycle_group_code == 4  ~ "Couple w dependents, eldest 5-14",
life_cycle_group_code == 5  ~ "Couple w dependents, eldest 15-24",
life_cycle_group_code == 6  ~ "One parent w dependents",
life_cycle_group_code == 7  ~ "Couple w dep & non-dep",
life_cycle_group_code == 8  ~ "Couple w non-dep only",
life_cycle_group_code == 9  ~ "Couple (ref 55-64)",
life_cycle_group_code == 10 ~ "Couple (ref 65+)",
life_cycle_group_code == 11 ~ "Lone person 65+",
TRUE ~ paste0("Other (", life_cycle_group_code, ")")
),
housing_stress_flag = case_when(
!is.na(weekly_housing_cost_pct) & weekly_housing_cost_pct > 30 ~ 1L,
!is.na(weekly_housing_cost_pct) & weekly_housing_cost_pct <= 30 ~ 0L,
TRUE ~ NA_integer_
),
ability_raise_2000 = case_when(
ability_raise_2000_flag == 1 ~ "Can raise $2000",
ability_raise_2000_flag == 5 ~ "Cannot raise $2000",
TRUE ~ NA_character_
)
)
#Set up survey replicate design (household)
rep_cols <- grep("^WHS\\d{2}$", names(hh_merged), value = TRUE)
if(length(rep_cols) < 1) stop("Replicate weight columns WHS01..WHS60 not found. Rename or supply replicate weights.")
# create srvyr survey object using Fay method (rho = 0.5)
hh_svy <- hh_merged %>%
as_survey_rep(weights = hh_weight,
repweights = all_of(rep_cols),
type = "Fay",
rho = 0.5)
# Proportion of households in housing stress (>30%) by life-cycle group
stress_by_life <- hh_svy %>%
group_by(life_cycle_group) %>%
summarize(
pct_stress = survey_mean(housing_stress_flag, vartype = c("ci","se"), na.rm = TRUE)
) %>%
arrange(desc(pct_stress))
stress_by_life %>% collect() %>% print(n = Inf)
#Mean weekly housing cost % by life-cycle group
mean_cost_by_life <- hh_svy %>%
group_by(life_cycle_group) %>%
summarize(
mean_hc_pct = survey_mean(weekly_housing_cost_pct, vartype = c("ci","se"), na.rm = TRUE)
) %>%
arrange(desc(mean_hc_pct))
mean_cost_by_life %>% collect() %>% print(n = Inf)
plot1_df <- stress_by_life %>%
collect() %>%
mutate(
pct = pct_stress * 100,
low = pct_stress_low * 100,
up  = pct_stress_upp * 100
) %>%
arrange(pct) %>%
mutate(life_cycle_group = factor(life_cycle_group, levels = unique(life_cycle_group)))
p1 <- ggplot(plot1_df, aes(x = life_cycle_group, y = pct)) +
geom_col() +
geom_errorbar(aes(ymin = low, ymax = up), width = 0.2) +
coord_flip() +
scale_y_continuous(labels = function(x) paste0(x, "%")) +
labs(
title = "Proportion of Households in Housing Stress (>30% housing costs)",
x = "Life-cycle group",
y = "Percent of households (weighted, 95% CI)"
) +
theme_minimal(base_size = 12)
# Save plot
ggsave("plot_housing_stress_by_lifecycle.png", p1, width = 10, height = 6, dpi = 300)
plot2_df <- mean_cost_by_life %>%
collect() %>%
mutate(
mean_pct = mean_hc_pct * 1,
low = mean_hc_pct_low * 1,
up = mean_hc_pct_upp * 1
) %>%
arrange(mean_pct) %>%
mutate(life_cycle_group = factor(life_cycle_group, levels = unique(life_cycle_group)))
p2 <- ggplot(plot2_df, aes(x = life_cycle_group, y = mean_pct)) +
geom_col() +
geom_errorbar(aes(ymin = low, ymax = up), width = 0.2) +
coord_flip() +
labs(
title = "Mean Weekly Housing Cost (% of gross household income) by Life-cycle group",
x = "Life-cycle group",
y = "Mean weekly housing cost (%) (weighted, 95% CI)"
) +
theme_minimal(base_size = 12)
# Save plot
ggsave("plot_mean_housing_cost_by_lifecycle.png", p2, width = 10, height = 6, dpi = 300)
# Print to the HTML output
p1
p2
plot1_df <- stress_by_life %>%
collect() %>%
mutate(
pct = pct_stress * 100,
low = pct_stress_low * 100,
up  = pct_stress_upp * 100
) %>%
arrange(pct) %>%
mutate(life_cycle_group = factor(life_cycle_group, levels = unique(life_cycle_group)))
p1 <- ggplot(plot1_df, aes(x = life_cycle_group, y = pct)) +
geom_col() +
geom_errorbar(aes(ymin = low, ymax = up), width = 0.2) +
coord_flip() +
scale_y_continuous(labels = function(x) paste0(x, "%")) +
labs(
title = "Proportion of Households in Housing Stress (>30% housing costs)",
x = "Life-cycle group",
y = "Percent of households (weighted, 95% CI)"
) +
theme_minimal(base_size = 12)
# Save plot
ggsave("plot_housing_stress_by_lifecycle.png", p1, width = 10, height = 6, dpi = 300)
plot2_df <- mean_cost_by_life %>%
collect() %>%
mutate(
mean_pct = mean_hc_pct * 1,
low = mean_hc_pct_low * 1,
up = mean_hc_pct_upp * 1
) %>%
arrange(mean_pct) %>%
mutate(life_cycle_group = factor(life_cycle_group, levels = unique(life_cycle_group)))
p2 <- ggplot(plot2_df, aes(x = life_cycle_group, y = mean_pct)) +
geom_col() +
geom_errorbar(aes(ymin = low, ymax = up), width = 0.2) +
coord_flip() +
labs(
title = "Mean Weekly Housing Cost (% of gross household income) by Life-cycle group",
x = "Life-cycle group",
y = "Mean weekly housing cost (%) (weighted, 95% CI)"
) +
theme_minimal(base_size = 12)
# Save plot
ggsave("plot_mean_housing_cost_by_lifecycle.png", p2, width = 10, height = 6, dpi = 300)
# Print to the HTML output
p1
p2
plot1_df <- stress_by_life %>%
collect() %>%
mutate(
pct = pct_stress * 100,
low = pct_stress_low * 100,
up  = pct_stress_upp * 100
) %>%
arrange(pct) %>%
mutate(life_cycle_group = factor(life_cycle_group, levels = unique(life_cycle_group)))
p1 <- ggplot(plot1_df, aes(x = life_cycle_group, y = pct)) +
geom_col() +
geom_errorbar(aes(ymin = low, ymax = up), width = 0.2) +
coord_flip() +
scale_y_continuous(labels = function(x) paste0(x, "%")) +
labs(
title = "Proportion of Households in Housing Stress (>30% housing costs)",
x = "Life-cycle group",
y = "Percent of households (weighted, 95% CI)"
) +
theme_minimal(base_size = 12)
# Save plot
ggsave("plot_housing_stress_by_lifecycle.png", p1, width = 10, height = 6, dpi = 300)
plot2_df <- mean_cost_by_life %>%
collect() %>%
mutate(
mean_pct = mean_hc_pct * 1,
low = mean_hc_pct_low * 1,
up = mean_hc_pct_upp * 1
) %>%
arrange(mean_pct) %>%
mutate(life_cycle_group = factor(life_cycle_group, levels = unique(life_cycle_group)))
p2 <- ggplot(plot2_df, aes(x = life_cycle_group, y = mean_pct)) +
geom_col() +
geom_errorbar(aes(ymin = low, ymax = up), width = 0.2) +
coord_flip() +
labs(
title = "Mean Weekly Housing Cost (% of gross household income) by Life-cycle group",
x = "Life-cycle group",
y = "Mean weekly housing cost (%) (weighted, 95% CI)"
) +
theme_minimal(base_size = 12) +
theme(
plot.title = element_text(size = 10)
)
# Save plot
ggsave("plot_mean_housing_cost_by_lifecycle.png", p2, width = 10, height = 6, dpi = 300)
# Print to the HTML output
p1
p2
plot1_df <- stress_by_life %>%
collect() %>%
mutate(
pct = pct_stress * 100,
low = pct_stress_low * 100,
up  = pct_stress_upp * 100
) %>%
arrange(pct) %>%
mutate(life_cycle_group = factor(life_cycle_group, levels = unique(life_cycle_group)))
p1 <- ggplot(plot1_df, aes(x = life_cycle_group, y = pct)) +
geom_col() +
geom_errorbar(aes(ymin = low, ymax = up), width = 0.2) +
coord_flip() +
scale_y_continuous(labels = function(x) paste0(x, "%")) +
labs(
title = "Proportion of Households in Housing Stress (>30% housing costs)",
x = "Life-cycle group",
y = "Percent of households (weighted, 95% CI)"
) +
theme_minimal(base_size = 12) +
theme(
plot.title = element_text(size = 10)
)
# Save plot
ggsave("plot_housing_stress_by_lifecycle.png", p1, width = 10, height = 6, dpi = 300)
plot2_df <- mean_cost_by_life %>%
collect() %>%
mutate(
mean_pct = mean_hc_pct * 1,
low = mean_hc_pct_low * 1,
up = mean_hc_pct_upp * 1
) %>%
arrange(mean_pct) %>%
mutate(life_cycle_group = factor(life_cycle_group, levels = unique(life_cycle_group)))
p2 <- ggplot(plot2_df, aes(x = life_cycle_group, y = mean_pct)) +
geom_col() +
geom_errorbar(aes(ymin = low, ymax = up), width = 0.2) +
coord_flip() +
labs(
title = "Mean Weekly Housing Cost (% of gross household income) by Life-cycle group",
x = "Life-cycle group",
y = "Mean weekly housing cost (%) (weighted, 95% CI)"
) +
theme_minimal(base_size = 12) +
theme(
plot.title = element_text(size = 10)
)
# Save plot
ggsave("plot_mean_housing_cost_by_lifecycle.png", p2, width = 10, height = 6, dpi = 300)
# Print to the HTML output
p1
p2
